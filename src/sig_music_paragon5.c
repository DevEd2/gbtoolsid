// This is free and unencumbered software released into the public domain.
// For more information, please refer to <https://unlicense.org>
// bbbbbr 2020

#include <stdint.h>
#include <stdbool.h>

#include "common.h"
#include "gbtoolchainid.h"


// ==== Paragon 5
// Records can be at any location

    // Frequency table
    const uint8_t sig_paragon5_freq[] =
        {0x20, 0x00, 0x91, 0x00, 0xFC, 0x00, 0x60, 0x01, 0xC0, 0x01, 0x19, 0x02, 0x6E, 0x02, 0xBE,
         0x02, 0x0A, 0x03, 0x51, 0x03, 0x94, 0x03, 0xD4, 0x03, 0x10, 0x04, 0x48, 0x04, 0x7E, 0x04,
         0xB0, 0x04, 0xE0, 0x04, 0x0D, 0x05, 0x37, 0x05, 0x5F, 0x05, 0x85, 0x05, 0xA8, 0x05, 0xCA};
        // Continues below, but above is probably sufficient
        // 0x05, 0xEA, 0x05, 0x08, 0x06, 0x24, 0x06, 0x3F, 0x06, 0x58, 0x06, 0x70, 0x06, 0x86, 0x06,
        // 0x9C, 0x06, 0xB0, 0x06, 0xC2, 0x06, 0xD4, 0x06, 0xE5, 0x06, 0xF5, 0x06, 0x04, 0x07, 0x12,
        // 0x07, 0x1F, 0x07, 0x2C, 0x07, 0x38, 0x07, 0x43, 0x07, 0x4E, 0x07, 0x58, 0x07, 0x61, 0x07,
        // 0x6A, 0x07, 0x73, 0x07, 0x7A, 0x07, 0x82, 0x07, 0x89, 0x07, 0x90, 0x07, 0x96, 0x07, 0x9C,
        // 0x07, 0xA2, 0x07, 0xA7, 0x07, 0xAC, 0x07, 0xB1, 0x07, 0xB5, 0x07, 0xB9, 0x07, 0xBD, 0x07,
        // 0xC1, 0x07, 0xC5, 0x07, 0xC8, 0x07, 0xCB, 0x07, 0xCE, 0x07, 0xD1, 0x07, 0xD3, 0x07, 0xD6,
        // 0x07, 0xD8, 0x07, 0xDB, 0x07, 0xDD, 0x07, 0xDF, 0x07};

    // GBSoundSystem only (not 100% sure)
    // soundsys.asm : SSFP_multi_sfx
    const uint8_t sig_gbsoundsystem_SSFP_multi_sfx[] = {0x57, 0x78, 0x06, 0x00, 0x87, 0xCB, 0x10, 0x87, 0xCB, 0x10, 0x87, 0xCB, 0x10, 0x83, 0x6F, 0x3E, 0x00, 0x8A, 0x80, 0x67};

    // Paragon5 only
    // sndsys_c.asm : MultiSFXLoop
    const uint8_t sig_paragon5_MultiSFXLoop[] = {0x2A, 0x4E, 0x06, 0x00, 0x87, 0xCB, 0x10, 0x87, 0xCB, 0x10, 0x87, 0xCB, 0x10};


// Check for paragon5 sound and sample driver
//
// If match is found: calls set_music() and returns true
//
bool check_music_paragon5(void) {

    const char str_paragon5_driver[]            = "Paragon 5";
    const char str_version_original[]           = "Original";
    const char str_version_gameboysoundsystem[] = "GBSoundSystem";

    // paragon5 & GBSoundSystem shared frequency table
    if (find_pattern(sig_paragon5_freq, sizeof(sig_paragon5_freq))) {

        // GBSoundSystem
        if (find_pattern(sig_gbsoundsystem_SSFP_multi_sfx, sizeof(sig_gbsoundsystem_SSFP_multi_sfx))) {
            //set_music(str_gbsoundsystem_music, "1.0");
            set_music(str_paragon5_driver, str_version_gameboysoundsystem);
            return true;
        }
        // Optional extra validation
        // // GBSoundSystem
        // else if (find_pattern(sig_paragon5_MultiSFXLoop, sizeof(sig_paragon5_MultiSFXLoop))) {
        //     set_music(str_paragon5_driver, str_version_original);
        //     return true;
        // }

        set_music(str_paragon5_driver, str_version_original);
        return true;
    }

    return false;
}
